<% layout('layout/boilerplate', {title}) %>

  <h1 class="text-center"><code>Pokemon List</code></h1>

  <form action="/pokemon" method="GET" class="w-xl-50 w-100 container d-flex form-inline justify-content-center my-5">
    <input value="<%= searchQuery %>" name="query" type="text" id="search" class="form-control w-50 me-4" placeholder="Search Pokemon">
    <button type="submit" class="btn btn-primary me-4">Search</button>
    <select name="type" class="form-select w-50 me-4">
      <option value="">Select Type</option>
      <% ['Poison', 'Plante' , 'Feu' , 'Vol' , 'Eau' , 'Insecte' , 'Normal' , 'Électrik' , 'Sol' , 'Fée' , 'Combat' , 'Psy' , 'Roche' , 'Acier' , 'Glace', 'Spectre' ].forEach(function(type) { %>
        <option value="<%= type %>" <%= type === selectedType ? 'selected' : '' %>>
          <%= type %>
        </option>
        <% }); %>
        
    </select>
    <button type="submit" class="btn btn-primary">Filter</button>
  </form>

  <!-- Cach 1 -->
  <section class="pokemon-section mt-5 px-4">
    <% pokes.forEach(function(poke) { %>
      <!-- <div class="card">
      <div class="card-header">
        <%= poke.name %>
      </div>
      <div class="card-body">
        <p><%= poke.type %></p>
        <p><%= poke.description %></p>
      </div>
    </div> -->
      <%- include('../../components/Card.ejs', { 
        id: poke.pokedexId, 
        header : poke.name, 
        src: poke.sprite, 
        link: `/pokemon/${poke.pokedexId}`, 
        icon: `<svg
        xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-id" width="24" height="24" viewBox="0 0 24 24" stroke-width="2"
        stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
        <path d="M3 4m0 3a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v10a3 3 0 0 1 -3 3h-12a3 3 0 0 1 -3 -3z"></path>
        <path d="M9 10m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"></path>
        <path d="M15 8l2 0"></path>
        <path d="M15 12l2 0"></path>
        <path d="M7 16l10 0"></path>
        </svg>`}) %>
        <% }); %>
  </section>

  <script nonce="<%= nonce %>">
    console.log('Hello from the Pokémon list page!');
    document.addEventListener('DOMContentLoaded', function() {
      console.log('The DOM is ready!');
      var popoverTriggerList = [].slice.call(document.querySelectorAll('.card[data-bs-toggle="popover"]'));
      var popoverList = popoverTriggerList.map(function(popoverTriggerEl) {
        return new bootstrap.Popover(popoverTriggerEl, {
          trigger: 'hover', // Trigger the popover on hover
          html: true, // Allow HTML content inside the popover
          content: 'Loading...', // Initial content
        });
      });
    
      popoverTriggerList.forEach(function(popoverTriggerEl) {
        popoverTriggerEl.addEventListener('mouseenter', function() {
          console.log('Popover shown!');
          var popoverInstance = bootstrap.Popover.getInstance(popoverTriggerEl);
          var pokemonId = popoverTriggerEl.getAttribute('data-pokemon-id');
          // Fetch the Pokémon details using the ID
          fetch(`/pokemon/data/${pokemonId}`)
            .then(response => response.json())
            .then(pokemonDetails => {
              // Update the popover content with Pokémon details
              popoverInstance.dispose();

              // Create a new popover instance with the new content
              popoverInstance = new bootstrap.Popover(popoverTriggerEl, {
                content: createPopoverContent(pokemonDetails),
                html: true,
                trigger: 'hover'
              });

              // Show the popover
              popoverInstance.show();
            })
            .catch(error => console.error('Error:', error));
        });
      });
    
      // Function to create content for the popover
      function createPopoverContent(pokemonDetails) {
        // Create HTML content based on the fetched Pokémon details
        console.log(pokemonDetails);
        return `
          <div class="pokemon-details">
            <h5>${pokemonDetails.name}</h5>
            <img src="${pokemonDetails.sprite}" class="w-100">
          </div>
        `;
      }
    });
    </script>
    